<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Test</title>
    <style>
        body {
            font-family: monospace;
            padding: 2rem;
            background: #1e1e1e;
            color: #00ff00;
        }
        .test-item {
            padding: 0.5rem;
            margin: 0.5rem 0;
            border-left: 3px solid #666;
            padding-left: 1rem;
        }
        .success { border-color: #00ff00; }
        .error { border-color: #ff0000; color: #ff0000; }
        .pending { border-color: #ffff00; color: #ffff00; }
        pre {
            background: #2d2d2d;
            padding: 1rem;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üî• Firebase Diagnostics</h1>
    <div id="results"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        const results = document.getElementById('results');
        
        function log(message, type = 'pending') {
            const div = document.createElement('div');
            div.className = `test-item ${type}`;
            div.textContent = message;
            results.appendChild(div);
            console.log(message);
        }

        function logPre(title, data) {
            const div = document.createElement('div');
            div.className = 'test-item success';
            div.innerHTML = `<strong>${title}:</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
            results.appendChild(div);
        }

        async function runTests() {
            log('Starting Firebase diagnostics...', 'pending');

            // Test 1: Firebase SDK loaded
            if (typeof firebase !== 'undefined') {
                log('‚úÖ Firebase SDK loaded', 'success');
                log(`   Version: ${firebase.SDK_VERSION}`, 'success');
            } else {
                log('‚ùå Firebase SDK not loaded!', 'error');
                return;
            }

            // Test 2: Initialize Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyBrYhf0kOBOouieiKZpjc0Nu5NN0qk8xI8",
                authDomain: "lstv-annotation-tool.firebaseapp.com",
                projectId: "lstv-annotation-tool",
                storageBucket: "lstv-annotation-tool.firebasestorage.app",
                messagingSenderId: "525812647843",
                appId: "1:525812647843:web:dd6fc8e55513fdca1a3c16"
            };

            try {
                firebase.initializeApp(firebaseConfig);
                log('‚úÖ Firebase initialized', 'success');
                logPre('Config', firebaseConfig);
            } catch (error) {
                log(`‚ùå Firebase init error: ${error.message}`, 'error');
                return;
            }

            // Test 3: Auth service
            try {
                const auth = firebase.auth();
                log('‚úÖ Auth service initialized', 'success');
                
                // Check current user
                const user = auth.currentUser;
                if (user) {
                    log(`‚úÖ User already signed in: ${user.email}`, 'success');
                } else {
                    log('‚ÑπÔ∏è  No user currently signed in', 'pending');
                }
            } catch (error) {
                log(`‚ùå Auth error: ${error.message}`, 'error');
            }

            // Test 4: Firestore service
            try {
                const db = firebase.firestore();
                log('‚úÖ Firestore service initialized', 'success');
                
                // Try to count studies
                const snapshot = await db.collection('studies').limit(1).get();
                log(`‚úÖ Firestore connection successful`, 'success');
                log(`   Studies collection exists: ${snapshot.size > 0 ? 'Yes' : 'Empty'}`, 'success');
            } catch (error) {
                log(`‚ùå Firestore error: ${error.message}`, 'error');
            }

            // Test 5: Storage service
            try {
                const storage = firebase.storage();
                log('‚úÖ Storage service initialized', 'success');
                log(`   Bucket: ${storage.app.options.storageBucket}`, 'success');
            } catch (error) {
                log(`‚ùå Storage error: ${error.message}`, 'error');
            }

            // Test 6: Network connectivity
            try {
                const response = await fetch('https://www.google.com/favicon.ico');
                if (response.ok) {
                    log('‚úÖ Network connectivity OK', 'success');
                } else {
                    log('‚ö†Ô∏è  Network response not OK', 'pending');
                }
            } catch (error) {
                log(`‚ùå Network error: ${error.message}`, 'error');
            }

            log('', 'pending');
            log('=== DIAGNOSTICS COMPLETE ===', 'success');
            log('If all tests passed, Firebase is working correctly.', 'success');
            log('Check the browser console (F12) for detailed logs.', 'pending');
        }

        // Run tests on page load
        window.addEventListener('load', runTests);
    </script>
</body>
</html>
